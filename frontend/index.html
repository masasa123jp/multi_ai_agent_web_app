<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Multi-AI Agent Workflow Monitor</title>

  <!-- ── Bootstrap CSS ───────────────────────────────────────────────── -->
  <!-- モジュール役割: Bootstrap の基本スタイルを読み込む -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- ── Bootstrap Icons ─────────────────────────────────────────────── -->
  <!-- モジュール役割: アイコンフォント（Bi*）を読み込む -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <!-- ── Mermaid (非モジュール版) ────────────────────────────────────── -->
  <!-- モジュール役割: フローチャートなどをテキストから描画 -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: false });</script>

  <!-- ── カスタム CSS ───────────────────────────────────────────────── -->
  <!-- モジュール役割: アプリ固有のレイアウト・色などを定義 -->
  <link href="css/style.css" rel="stylesheet"/>
  <link href="css/auth.css"  rel="stylesheet"/>

  <!-- ── グローバル変数の初期化 ─────────────────────────────────────── -->
  <!-- モジュール役割: ワークフローIDや予算上限を Vue コンポーネントへ渡す -->
  <script>
    window.__CURRENT_WORKFLOW_ID__ = window.__CURRENT_WORKFLOW_ID__ || null;
    window.__CURRENT_MAX_COST__    = window.__CURRENT_MAX_COST__    || null;
  </script>

  <!-- ── Vue 3 ランタイム (グローバルビルド) ────────────────────────── -->
  <!-- モジュール役割: Vue コンポーネントのレンダリング環境を提供 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- ── CostProgressApp コンポーネント ──────────────────────────────── -->
  <!-- モジュール役割: 累積コストをプログレスバーで表示 -->
  <script type="module" src="js/costProgressApp.js"></script>

  <!-- ── ES Module Shims Polyfill ─────────────────────────────────────── -->
  <!-- モジュール役割: 古いブラウザで Import Map を使えるようにする -->
  <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1/dist/es-module-shims.min.js"></script>

  <!-- ── Import Map 定義 ─────────────────────────────────────────────── -->
  <!-- モジュール役割: ライブラリ名を CDN URL にマッピング -->
  <script type="importmap">
  {
    "imports": {
      "@popperjs/core": "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/esm/popper.min.js",
      "bootstrap":      "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.esm.min.js"
    }
  }
  </script>

  <!-- ── アプリ本体 ES Modules ──────────────────────────────────────── -->
  <!-- モジュール役割: 各機能ごとの JavaScript モジュールを読み込む -->
  <script type="module">import "bootstrap";</script>
  <script type="module" src="js/config.js"></script>
  <script type="module" src="js/ui.js"></script>
  <script type="module" src="js/api.js"></script>
  <script type="module" src="js/chart.js"></script>
  <script type="module" src="js/flow.js"></script>
  <script type="module" src="js/file_upload.js"></script>
  <script type="module" src="js/history.js"></script>
  <script type="module" src="js/ws.js"></script>
  <script type="module" src="js/main.js"></script>
  <script type="module" src="js/auth.js"></script>
</head>

<body class="bg-light">

  <!-- ─────────────── ログインフォーム ─────────────── -->
  <!-- モジュール役割: 認証未完了時に表示。submit で auth.js が処理を開始 -->
  <!-- 初期状態: ログインフォームを表示 -->
  <div id="login-container"
       class="d-flex justify-content-center align-items-center vh-100">
    <div class="card login-card shadow-sm">
      <div class="card-body">
        <h4 class="card-title text-center mb-4">ログイン</h4>
        <form id="loginForm" novalidate>
          <div class="mb-3">
            <label for="username" class="form-label">Email</label>
            <input type="email"
                   id="username"
                   name="username"
                   class="form-control"
                   placeholder="you@example.com"
                   required />
          </div>
          <div class="mb-4">
            <label for="password" class="form-label">Password</label>
            <input type="password"
                   id="password"
                   name="password"
                   class="form-control"
                   placeholder="Password"
                   required />
          </div>
          <button type="submit"
                  class="btn btn-primary w-100">ログイン</button>
          <!-- エラーメッセージ表示領域 -->
          <div id="errorMessage" class="text-danger mt-2"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- ─────────────── メイン画面 ─────────────── -->
  <!-- モジュール役割: 認証後に initApp() によって表示されるアプリ本体 -->
  <!-- 初期状態: 非表示（.d-none で隠す）  -->
  <div id="app" class="container-fluid mt-4 d-none">

    <!-- Navbar -->
    <!-- モジュール役割: アプリケーション名とレスポンシブメニュー -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary px-3 mb-4">
      <a class="navbar-brand fw-bold" href="#">AI Workflow</a>
      <button class="navbar-toggler"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navbarNav" class="collapse navbar-collapse"></div>
    </nav>

    <div class="row">
      <!-- Sidebar -->
      <!-- モジュール役割: サイドバー項目とログアウトボタンを buildSidebar() が描画 -->
      <aside id="sidebar" class="col-md-2 mb-3"></aside>

      <!-- Main Pane -->
      <!-- モジュール役割: コントロールパネルや各種セクションを buildMain() が描画 -->
      <main id="main-pane" class="col-md-10 d-flex flex-column gap-3">
        <!-- buildMain() で挿入される要素群 -->
      </main>
    </div>

    <!-- Vue コストプログレス用マウント先 -->
    <!-- モジュール役割: costProgressApp.js がここにプログレスバーを表示 -->
    <div id="cost-progress-app" class="mt-4"></div>

  </div>

</body>
</html>
